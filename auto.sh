#!/bin/bash

generatereport() {
	pandoc -s --toc --css style.css $path/*.md -o $path/report_$timestamp.html
	if [[ $? = 0 ]]; then
		echo "Report file successfully generated in $path/report_$timestamp.html"
	else
		echo 'Unable to generate report file'
	fi
	cp style.css $path/
} # generatereport

printstatus() {
	if [[ $? = 0 ]]; then
		echo -e "[\033[0;32m  OK  \033[0m] $@"
	else
		echo -e "[\033[0;31mFAILED\033[0m] $@"
	fi
} # printstatus

./switch_led.sh heartbeat

timestamp=$(date +"%Y%m%d_%H%M%S")
path=$(pwd)/results/$timestamp
mkdir -p $path

# IP Details
./tests/ip.sh $path
printstatus IP Details

# ICMP Test
./tests/ping.sh $path
printstatus ICMP Test

# Traceroute
./tests/traceroute.sh $path
printstatus Traceroute

generatereport

./switch_led.sh default
exit 0
