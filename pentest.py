#!/usr/bin/env python3
from datetime import datetime
from os import makedirs, listdir, path, remove
from os.path import dirname, realpath
from shutil import copyfile

from tests import *
from tools import leds
from tools.pandoc import Pandoc

Test.interface.name = "wlan1"
Test.results_path = dirname(realpath(__file__)) + "/results/" + datetime.now().strftime("%Y%m%d_%H%M%S") + "/"
Test.tmp_path = Test.results_path + "tmp/"

logo = """
             ███▄    █  █    ██  ██▓  ▄████                  
             ██ ▀█   █  ██  ▓██▒▓██▒ ██▒ ▀█▒                 
            ▓██  ▀█ ██▒▓██  ▒██░▒██▒▒██░▄▄▄░                 
            ▓██▒  ▐▌██▒▓▓█  ░██░░██░░▓█  ██▓                 
            ▒██░   ▓██░▒▒█████▓ ░██░░▒▓███▀▒                 
            ░ ▒░   ▒ ▒ ░▒▓▒ ▒ ▒ ░▓   ░▒   ▒                  
            ░ ░░   ░ ▒░░░▒░ ░ ░  ▒ ░  ░   ░                  
               ░   ░ ░  ░░░ ░ ░  ▒ ░░ ░   ░                  
                     ░    ░      ░        ░                  
 ██▓███  ▓█████  ███▄    █ ▄▄▄█████▓▓█████   ██████ ▄▄▄█████▓
▓██░  ██▒▓█   ▀  ██ ▀█   █ ▓  ██▒ ▓▒▓█   ▀ ▒██    ▒ ▓  ██▒ ▓▒
▓██░ ██▓▒▒███   ▓██  ▀█ ██▒▒ ▓██░ ▒░▒███   ░ ▓██▄   ▒ ▓██░ ▒░
▒██▄█▓▒ ▒▒▓█  ▄ ▓██▒  ▐▌██▒░ ▓██▓ ░ ▒▓█  ▄   ▒   ██▒░ ▓██▓ ░ 
▒██▒ ░  ░░▒████▒▒██░   ▓██░  ▒██▒ ░ ░▒████▒▒██████▒▒  ▒██▒ ░ 
▒▓▒░ ░  ░░░ ▒░ ░░ ▒░   ▒ ▒   ▒ ░░   ░░ ▒░ ░▒ ▒▓▒ ▒ ░  ▒ ░░   
░▒ ░      ░ ░  ░░ ░░   ░ ▒░    ░     ░ ░  ░░ ░▒  ░ ░    ░    
░░          ░      ░   ░ ░   ░         ░   ░  ░  ░    ░      
            ░  ░         ░             ░  ░      ░           
"""


def _setup():
    leds.led_mode("green", "heartbeat")
    print(logo)
    Test.interface.check()
    try:
        makedirs(Test.results_path)
        makedirs(Test.tmp_path)
    except FileExistsError:
        pass
    Ip()


def _run_all():
    Cdp()
    DynamicRouting()
    Fhrp()
    NbtScan()
    Nmap()
    Ping()
    PublicIp()
    Traceroute()
    Wep()
    WifiScan()


def generate_report():
    Pandoc()
    copyfile(dirname(realpath(__file__)) + "/style.css", Test.results_path + "style.css")


def _clean():
    for file in listdir(dirname(realpath(__file__))):
        if "replay_arp" in file and path.isfile(file):
            remove(file)
    leds.led_mode("green", "default-on")


_setup()
# _run_all()
Wep()
generate_report()
_clean()
