#!/usr/bin/env python3
from subprocess import DEVNULL, Popen

from tests import Test
from tools.config import Config


class Aireplay:

    def fake_auth(self, target):
        # Performing fake authentication
        auth = Popen(
            [Config.aireplay_bin, "-1", "6000", "-o", "1", "-q", "10", "-a", target.bssid, Test.interface.name],
            stdout=DEVNULL, stderr=DEVNULL)
        return auth

    def arp_requesting(self, target):
        # ARP requesting in replay mode
        airodump_arp_req = Popen(
            [Config.aireplay_bin, "-3", "-b", target.bssid, Test.interface.name], stdout=DEVNULL, stderr=DEVNULL)
        return airodump_arp_req

    def deauth_broadcast(self, target):
        # Deauthentication broadcast
        airodump_deauth = Popen(
            [Config.aireplay_bin, "-0", str(Config.aireplay_deauth_packets), "--ignore-negative-one", "-a",
             target.bssid,
             Test.interface.name], stdout=DEVNULL, stderr=DEVNULL)
        return airodump_deauth

    def deauth_client(self, target, client):
        # Deauthentication client
        airodump_deauth = Popen(
            [Config.aireplay_bin, "-0", str(Config.aireplay_deauth_packets), "--ignore-negative-one", "-a",
             target.bssid,
             "-c", client.mac, Test.interface.name], stdout=DEVNULL, stderr=DEVNULL)
        return airodump_deauth
