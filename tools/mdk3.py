#!/usr/bin/env python3
from subprocess import TimeoutExpired, run, PIPE, STDOUT

from tests import Test
from tools.config import Config


class Mdk3:
    def dictionary(self, target):
        ssid = None
        try:
            mdk = run(
                [Config.mdk3_bin, Test.interface.name, "p", "-f", Config.mdk3_ssids, "-t", target.bssid, "-c",
                 target.channel],
                stdout=PIPE, stderr=STDOUT, timeout=Config.mdk3_timeout)
        except TimeoutExpired as e:
            results = e.stdout.decode()
        else:
            results = mdk.stdout.decode()

        for line in results.splitlines():
            if target.bssid in line:
                ssid = line.split('"')[1]

        return ssid
