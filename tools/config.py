#!/usr/bin/env python3
import configparser
import os

from datetime import datetime

from tests import Test


class Config:
    airodump_scan_duration = 10

    def __init__(self, path):
        self.path = path
        self.config = configparser.ConfigParser()
        self._read()
        self._parse()

    def _read(self):
        self.config.read(self.path)

    def _parse(self):
        self.results_dir = self.config['General']['ResultsDir']
        self.results_dir_format = self.config['General']['ResultsDirFormat']
        Config.results_file = self.config['General']['ResultsFile']
        Test.results_path = os.getcwd() + "/" + self.results_dir + "/" + datetime.now().strftime(
            self.results_dir_format) + "/"
        Config.temp_dir = self.config['General']['TempDir']
        Test.tmp_path = Test.results_path + Config.temp_dir + "/"
        Config.oui_path = self.config['General']['OuiPath']
        self.interface = self.config['Network']['Interface']
        Test.interface.name = self.interface
        Config.aircrack_bin = self.config['Aircrack']['Bin']
        Config.aircrack_timeout = int(self.config['Aircrack']['Timeout'])
        Config.airodump_bin = self.config['Airodump']['Bin']
        Config.airodump_scan_duration = int(self.config['Airodump']['ScanDuration'])
        Config.aireplay_bin = self.config['Aireplay']['Bin']
        Config.aireplay_deauth_packets = int(self.config['Aireplay']['DeauthPacketsCount'])
        Config.mdk3_bin = self.config['Mdk3']['Bin']
        Config.mdk3_ssids_url = self.config['Mdk3']['URLDictionary']
        Config.mdk3_ssids = self.config['Mdk3']['SSIDDictionary']
        Config.mdk3_timeout = int(self.config['Mdk3']['Timeout'])
        Config.reaver_bin = self.config['Reaver']['Bin']
        Config.reaver_timeout = int(self.config['Reaver']['Timeout'])
        Config.wash_bin = self.config['Wash']['Bin']
        Config.wash_scan_duration = int(self.config['Wash']['ScanDuration'])

    def __str__(self):
        return "Config:" + "\nResults dir:" + self.results_dir + "\nResults dir format:" + self.results_dir_format + \
               "\nResults path:" + Test.results_path + "\nTemp dir:" + self.temp_dir + "\nInterface:" + self.interface \
               + "\nAirodump scan duration:" + str(Config.airodump_scan_duration)
