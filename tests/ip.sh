#!/bin/bash

if [[ $# -ne 1 ]]; then
        echo "Syntax : $0 testname"
        exit 1
fi

./switch_led.sh on
filename=$1/$(basename -- $0 .sh).md
status=0

echo '# IP details' > $filename
echo 'Display the IP address details assigned to the wlan1 interface via DHCP. The IP address, Subnet Mask, Default Gateway and DNS information is listed.' >> $filename
echo >> $filename
echo '## Vulnerability' >> $filename
echo 'This is part of the reconnaissance phase, where the attacker can identify information such as the IP subnet, the default gateway and DNS configuration for the local network.' >> $filename
echo >> $filename
echo '## Exploit' >> $filename
echo 'Although there is not a direct exploit for this vulnerability, the information yielded can be used in more advanced tests later.' >> $filename
echo >> $filename
echo '## Countermeasure' >> $filename
echo 'To prevent an unauthorised device from receiving DHCP assigned IP address information, the best countermeasure is to use IEEE 802.1x port authentication. Other, less desirable, options include shutting down the switch interface or disabling DHCP services.' >> $filename
echo >> $filename
echo '## Test results' >> $filename
echo '```' >> $filename

ifconfig wlan1 | grep 'wlan1\|inet' >> $filename #IP address
status2=$?
if [[ $status2 != 0 && $status2 != status ]]; then
	status=$status2
fi
echo >> $filename
nmcli dev show wlan1 >> $filename #Interface details
status2=$?
if [[ $status2 != 0 && $status2 != status ]]; then
	status=$status2
fi

echo '```' >> $filename
if [[ $status = 0 ]]; then
        echo '**IP details complete!**' >> $filename
else
        echo '**IP details NOT complete!**' >> $filename
fi
echo >> $filename
echo '---' >> $filename

./switch_led.sh off
exit $status

