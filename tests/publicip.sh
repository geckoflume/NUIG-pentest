#!/bin/bash

if [[ $# -ne 2 ]]; then
        echo "Syntax : $0 testname interface"
        exit 1
fi

./switch_led.sh on
filename=$1/$(basename -- $0 .sh).md

echo '# Public IP address' > $filename
echo 'The OG150 will attempt to connect to the Internet and provide information regarding to the Public IP address that it is using. Please Note: If this content is blank, the connection to the Internet was probably blocked by a firewall.' >> $filename
echo >> $filename
echo '## Vulnerability' >> $filename
echo 'This test yields important information relating to the Internet connection used by the target infrastructure.' >> $filename
echo >> $filename
echo '## Exploit' >> $filename
echo 'A user could use the test results to try and attack the target infrastructure ‘from’ the Internet. For example, assume that this test shows that the target infrastructure is using public IP address x.x.x.x. The user can, from anywhere on the Internet, attempt to penetrate the target infrastructure by focusing attacks on IP address x.x.x.x.' >> $filename
echo >> $filename
echo '## Countermeasure' >> $filename
echo 'For this test, the OG150 attempts to access a website on the Internet using TCP port 80 \(HTTP\). To prevent this type of attack consider using a web proxy to secure Internet access. The firewalls should permit the web proxies access to the Internet, whilst denying all other users access to the Internet on known website ports such as TCP port 80 \(HTTP\).' >> $filename
echo >> $filename
echo '## Test results' >> $filename
echo '```' >> $filename

#-s silent mode
#-m 20 maximum time of 20 seconds
curl -s -m 20 ifconfig.co &>> $filename
status=$?

echo '```' >> $filename
if [[ $status = 0 ]]; then
        echo '**Public IP address complete!**' >> $filename
else
        echo '**Public IP address NOT complete!**' >> $filename
fi
echo >> $filename
echo '---' >> $filename

./switch_led.sh off
exit $status

